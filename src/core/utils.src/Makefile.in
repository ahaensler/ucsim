#
# uCsim utils.src/Makefile
#
# (c) 1997 Drotos Daniel
#

PKG		= ucsimutil

include ../../common.mk

srcdir          = @srcdir@
VPATH           = @srcdir@

#DEFS            = $(subs -DHAVE_CONFIG_H,,@DEFS@)
OPT		?= 2

OBJECTS         = pobj.o globals.o utils.o error.o app.o option.o chars.o fio.o
ifeq ($(WINSOCK_AVAIL), 1)
OBJECTS		+= fwio.o
else
OBJECTS		+= fuio.o
endif


# Compiling entire program or any subproject
# ------------------------------------------
all: libs

libs: $(top_builddir)/lib$(PKG).a

apps:


# Compiling and installing everything and running test
# ---------------------------------------------------
install: all installdirs


# Deleting all the installed files
# --------------------------------
uninstall:
	rm -f $(DESTDIR)$(bindir)/s51$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/savr$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/serialview$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/portmon$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/sstm8$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/sst7$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/sp1516$(EXEEXT)
	rm -f $(DESTDIR)$(bindir)/sm6809$(EXEEXT)


# Performing self-test
# --------------------
check:

test:

# Performing installation test
# ----------------------------
installcheck:


# Creating installation directories
# ---------------------------------
installdirs:


# Creating dependencies
# ---------------------
dep: main.dep

main.dep: $(SOURCES) $(srcdir)/*.h
	$(MAKEDEP) $(CPPFLAGS) $(filter %.cc,$^) >main.dep

-include main.dep
include $(srcdir)/clean.mk


# My rules
# --------
$(top_builddir)/lib$(PKG).a: $(OBJECTS)
ifeq ($(SILENT),yes)
	@echo LIB $(TN)-$@
	@$(AR) -rc $@ $+ 	>>$(top_srcdir)/compile.log 2>&1
	@$(RANLIB) $@ 		>>$(top_srcdir)/compile.log 2>&1
else
	$(AR) -rc $@ $+
	$(RANLIB) $@
endif


# End of utils.src/Makefile
